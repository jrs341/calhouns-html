<!DOCTYPE html>
<html lang="en-us">
<head>
 	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<script type="application/ld+json">
	{
	  "@context": "http://schema.org",
	  "@type": [
	  "RVPark",
	  "Campground",
	  "LodgingBusiness"
	  ],
	  "name": "Calhoun's Riverside RV Retreat",
	  "openingHours": [
	    "Mo-Fr 09:00-18:00",
	    "Sa-Su 09:00-16:00"
	    ],
	  "telephone": "(361) 550-7536",
	  "url": "https://www.calhounsriversidervretreat.com",
	  "image": "https://www.calhounsriversidervretreat.com/css/images/circleC.png",
	  "priceRange": "$$",
	  "hasMap": 		"https://www.google.com/maps/place/125+Haeber+Ln,+Tivoli,+TX+77990/@28.4767777,-96.8629815,17z/data=!3m1!4b1!4m5!3m4!1s0x8669d8eb4b1185b9:0xc2267a66b6d7b93c!8m2!3d28.4767777!4d-96.8607928",
	  "checkinTime": "14:00",
	  "checkoutTime": "12:00",
	  "address": {
	    "@type": "PostalAddress",
	    "addressLocality": "Tivoli",
	    "addressRegion": "TX",
	    "postalCode": "77990",
	    "streetAddress": "125 Haeber Ln"
	  },
	  "aggregateRating": {
	    "@type": "AggregateRating",
	    "ratingValue": "4.5",
	    "reviewCount": "27"
	  },
	   "geo": {
	    "@type": [
	    "GeoCoordinates",
	    "GeoCircle"
	    ],
	    "latitude": "28.477294",
	    "longitude": "-96.861032",
	    "geoRadius": "45000"
	  }
	 }
	</script>
	<meta name="description" content="RV Park">
	<meta name="author" content="Jason Sinn">
	<link rel="shortcut icon" href="./css/images/favicon.ico">
	<link rel="stylesheet" href="css/alert.css">
  	<title>Calhoun's RV Retreat</title> 
<style type="text/css">
	.progress-container {
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-justify-content: center;
  -webkit-align-items: center;
	}

	form {
		display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
		-webkit-flex-direction: column;
	}

	fieldset {
		-webkit-flex-direction: row;
	}

	input {
		-webkit-flex: 20%;
	}

	label {
		-webkit-flex: 50%;
	}

	.row {
		display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
	}

</style> 	
</head>
<body>
	<header class="progress-container">
		<progress value="0" max="100"></progress>
	</header>
	<div class="alert"></div>
		<form action="" id="form" class="form" autocomplete="on">
			<script>
			/*document.querySelector('form.form').addEventListener('submit', function(e) {
  			e.preventDefault()
  				const formData = new FormData(this)
  				const entires = formData.entries()

  				for (var input of entires) {
    			console.log(input[0] + ': ' + input[1])
  				}
			})*/
			</script>
			<fieldset name="personal">
				<div class="row">
					<label for="email">Email Address</label>
					<input
						id="email"
						type="email"
						name="email"
						placeholder="you@gmail.com"
						maxlength="30"
						autofocus
						onchange="validateEmail(this)"
						required>
				</div>
				<br>
				<br>
				<div class="row">
					<label for="phone_number">Phone Number</label>
					<input 
						id="phone_number"
						type="phone_number"
						name="phone_number"
						placeholder="(123)456-7890"
						pattern="((\(\d{3}\) ?)|(\d{3}-))?\d{3}-\d{4}"
						minlength="10" 
						maxlength="14" 
						onchange="validatePhone(this)"
						required>
				</div>
  		<br>
  		<br>
  		<div class="row">
  			<label for="first_name">First Name</label>
					<input 
						id="first_name"
						type="text"
						name="first_name"
						placeholder="First Name"
						pattern="^[a-zA-Z]+$"
						onchange="capitalize(this)"
						required>
				</div>
				<br>
				<br>
				<div class="row">
					<label for="last_name">Last Name</label>
					<input 
						id = "last_name"
						type="text"
						name="last_name"
						placeholder="Last Name"
						pattern="^[a-zA-Z]+$"
						onchange="capitalize(this)"
						required>
				</div>
				<br>
				<br>
				<div class="row">
					<label for="drivers_state"> Drivers License Issuing State</label>
					<input 
						id="drivers_state"
						type="text"
						name="drivers_state"
						placeholder="ex. TX"
						pattern="^(?:(A[KLRZ]*|C[AOT]*|D[CE]*|F[L]*|G[A]*|H[I]*|I[ADLN]*|K[SY]*|L[A]*|M[ADEINOST]*|N[CDEHJMVY]*|O[HKR]*|P[AR]*|R[I]*|S[CD]*|T[NX]*|U[T]*|V[AIT]*|W[AIVY]*))$"
						minlength="2" 
						maxlength="2" 
						onchange="capitalize(this)"
						required>
				</div>
				<br>
				<br>
				<div class="row">
					<label for="drivers_number">Drivers License Number</label>
					<input
						id="drivers_number"
						type="text"
						name="drivers_number"
						placeholder="1234567"
						pattern="^[0-9a-zA-Z]+$"
						maxlength="15"
						onchange="driverNumber(this)"
						required>
				</div>
			</fieldset>
			<br>
			<fieldset>
				<div class="row">
					<label for="street">Street Address Line 1</label>
 				<input
 					id="street"
 					type="text"
 					name="street"
 					placeholder="Street Address Line 1"
 					onchange="capitalize(this)"
 					required>
 				</div>
 				<br>
 				<br>
 				<div class="row">
  				<label for="street2">Street Address Line 2</label>
  				<input
  					id="street2"
  					type="text"
  					name="street2"
  					placeholder="Street Address Line 2"
  					onchange="capitalize(this)">
  				</div>
  				<br>
  				<br>
  				<div class="row">
	  				<label for="city">City</label>
	  				<input
	  					id="city"
	  					type="text" 
	  					name="city"
	  					placeholder="City"
	  					onchange="capitalize(this)"
	  					required>
	  			</div>
  				<br>
  				<br>
  				<div class="row">
	  				<label for="state">State</label>
	  				<input 
								id="state"
								type="text"
								name="state"
								placeholder="ex. TX"
								pattern="^(?:(A[KLRZ]*|C[AOT]*|D[CE]*|F[L]*|G[A]*|H[I]*|I[ADLN]*|K[SY]*|L[A]*|M[ADEINOST]*|N[CDEHJMVY]*|O[HKR]*|P[AR]*|R[I]*|S[CD]*|T[NX]*|U[T]*|V[AIT]*|W[AIVY]*))$"
								minlength="2" 
								maxlength="2"
								onchange="capitalize(this)"
								required>
						</div>
						<br>
						<br>
						<div class="row">
							<label for="zipCode">Zip Code</label>
		  			<input 
		  				id="zipCode"
								type="text"
								name="zipCode"
								placeholder="567890"
								pattern="^[0-9]+$"
								minlength="5" 
								maxlength="5"
								onchange="validateAddress(this)" 
								required>
						</div>
					</fieldset>
			<br>
			<fieldset name="RV Info">
				<input 
					id="amp"
					type="text"
					name="amp"
					placeholder="Amps"
					>
			</fieldset>
			<br>
			<fieldset name="Vehicle Info">
				<input 
					id="vehicle_type"
					type="text"
					name="vehicle_type"
					placeholder="Vehicle"
					>
			</fieldset>
			<input type="submit">
			<button id="save">Save</button>
			<input type="reset">
		</form>
	<footer>
		
	</footer>
</body>
<script src="https://d79i1fxsrar4t.cloudfront.net/sdk/1.4.2/smartystreets-sdk-1.4.2.min.js"></script>
<script>

/* ===== Listener for Auto Fill events =====*/
/*const AUTOFILLED = 'is-autofilled'
const onAutoFillStart = (el) => {el.classList.add(AUTOFILLED)}
const onAutoFillCancel = (el) => el.classList.remove(AUTOFILLED)
const onAnimationStart = ({target, animationName}) => {
    switch (animationName) {
        case 'onAutoFillStart':
        	console.log('start')
            return onAutoFillStart(target)
        case 'onAutoFillCancel':
        	console.log('cancel')
            return onAutoFillCancel(target)
    	}
	}

document.querySelector('input').addEventListener('webkitAnimationStart', onAnimationStart, false)*/
const setProgress = (value) => {
	let progress = document.getElementsByTagName('progress')[0]
	console.log('progress', progress)
	return progress.value = progress.value + 10
}

/* ====== mailboxlayer.com ===== */
const validateEmail = (input) => {
	input.oninvalid = (event) => {
	event.target.setCustomValidity('')
	}
	const Http = new XMLHttpRequest()
	const url='https://apilayer.net/api/check?access_key=5dfcd20bef36ce857a1b68b92204a944&email='+input.value+'&smtp=1&format=1'
	/*Http.open("GET", url)
	Http.send()*/

	Http.onreadystatechange = (e) => {
		let response = JSON.parse(Http.responseText)
		if (response.mx_found) {
			setProgress()
			return
		} else {
			input.oninvalid = (event) => {
			event.target.setCustomValidity('Please enter a valid email address')
			}
		}
	}
}

const validatePhone = (input) =>{
	
	if(checkForNumbers(input.value) === 10){
		input.oninvalid = (event) => {
		event.target.setCustomValidity('')
		}
		var numbers = input.value.replace(/\D/g, ''),
		char = { 0: '(', 3: ') ', 6: '-' };
		phoneNumberFormat = '';
		for (var i = 0; i < numbers.length; i++) {
		phoneNumberFormat += (char[i] || '') + numbers[i];
		}
		input.value = phoneNumberFormat
		setProgress()
		return input.value
	} else {
		input.oninvalid = (event) => {
		event.target.setCustomValidity('Format should be (123) 456-7890 or enter 10 consecutive numbers')
		}
	}	
}

const checkForNumbers = (value) => {
	let length = value.replace(/[^0-9]/g,"").length
	return length
}

const checkForSpecialChar = (value) => {
	specialRegex = /[^A-Z a-z]/ 
 	return specialRegex.test(value)
}

const checkName = (input) => {
	input.oninvalid = (event) => {
	event.target.setCustomValidity('')
	}
	if (!checkForSpecialChar(input.value) && checkForNumbers(input.value) === 0){
		input.value = capitalizeFirst(input.value)
		setProgress()
		return input.value
	} else {
		input.oninvalid = (event) => {
		event.target.setCustomValidity('Only enter letters')
		}
	}
}

const checkState = (input) => {
	input.oninvalid = (event) => {
	event.target.setCustomValidity('')
	}
	if (!checkForSpecialChar(input.value) && checkForNumbers(input.value) === 0){
		input.value = input.value.toUpperCase()
		setAddress(input)
		setProgress()
		return input.value
	} else {
		input.oninvalid = (event) => {
		event.target.setCustomValidity('Only enter letters')
		}
	}
}

const capitalize = (input) => {
	switch(input.id){
		case 'first_name':
		checkName(input)
		break;
		case 'last_name':
		checkName(input)
		break;
		case 'street':
		input.value = capitalizeFirst(input.value)
		setAddress(input)
		setProgress()
		return input.value
		break;
		case 'street2':
		input.value = capitalizeFirst(input.value)
		setAddress(input)
		return input.value
		break;
		case 'city':
		input.value = capitalizeFirst(input.value)
		setAddress(input)
		setProgress()
		return input.value
		break;
		case 'state':
		checkState(input)
		break;
		case 'drivers_state':
		checkState(input)
		break;
		default:
	}
}

const capitalizeFirst = (value) => {
	let string = value.split(' ').map(w => w[0].toUpperCase()+ w.substr(1).toLowerCase()).join(' ')
	return string
}

let address = {
	street:'',
	street2:'',
	city:'',
	state:'',	
	zipCode:''
}

const setAddress = (input) => {
	address[input.id] = input.value
}

const validateAddress = (input) => {
	
	/*const urlAddress = 'https://us-street.api.smartystreets.com/street-address?street=123+main+Schenectady+NY&key=8126254261288690'
	const Http = new XMLHttpRequest()
	Http.open("GET", urlAddress)
	Http.send()
	Http.onreadystatechange = (e) => {
		let response = JSON.parse(Http.responseText)
		if (response.mx_found) {
			displayAlert('Email is Valid')
		} else {
			displayAlert('Please enter a valid email')
		}
	}*/
}

const driverNumber = (input) => {
	let drivers_number = document.getElementById('drivers_number')
	input.value = input.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase()
}	
 
	

	const formId = "form"; // ID of the form
	const url = location.href; //  href for the page
	const formIdentifier = `${url} ${formId}`; // Identifier used to identify the form
	const saveButton = document.querySelector("#save"); // select save button
	const alertBox = document.querySelector(".alert"); // select alert display div
	let form = document.querySelector(`#${formId}`); // select form

	let formElements = form.elements; // get the elements in the form
	const getFormData = () => {
  	let data = { [formIdentifier]: {} }; // create an empty object with the formIdentifier as the key and an empty object as its value
  	let formElements = form.elements;
  	for (const element of formElements) {
    	if (element.name.length > 0) {
      	data[formIdentifier][element.name] = element.value;
    	}
  	}
  	return data;
	};

saveButton.onclick = event => {
  event.preventDefault();
  data = getFormData();
  localStorage.setItem(formIdentifier, JSON.stringify(data[formIdentifier]));
  const message = "Form draft has been saved!";
  displayAlert(message);
};

/**
 * This function displays a message
 * on the page for 1 second
 *
 * @param {String} message
 */
const displayAlert = message => {
  alertBox.innerText = message; // add the message into the alert box
  alertBox.style.display = "block"; // make the alert box visible
  setTimeout(function() {
    alertBox.style.display = "none"; // hide the alert box after 1 second
  }, 1000);
};
const populateForm = () => {
  if (localStorage.key(formIdentifier)) {
    const savedData = JSON.parse(localStorage.getItem(formIdentifier)); // get and parse the saved data from localStorage
    let formElements = form.elements;
    for (const element of formElements) {
      if (element.name in savedData) {
        element.value = savedData[element.name];
      }
    }
    const message = "Form has been refilled with saved data!";
    displayAlert(message);
  }
};
document.onload = populateForm(); // populate the form when the document is loaded
</script>
</html>
